# トミカ存在チェッカー 設計書

## 1. 概要
所有トミカの管理を行うアプリケーション。NFCタグを使用してトミカの情報を取得し、所有状況を管理する。

---

## 2. システム構成
### 2.1 使用技術
- **フロントエンド**: React Native
- **データベース**: spabase
- **NFCタグ**: NTAG213
- **対応OS**: iOS、Android

### 2.2 アーキテクチャ
- **クライアントサイド**: React Nativeで構築。NFCタグの読み取り・書き込み、データ表示・編集を担当。
- **バックエンド**: Firebase Firestoreを使用してデータを管理。
- **NFC通信**: `react-native-nfc-manager`ライブラリを使用。

---

## 3. 機能詳細
### 3.1 トミカ情報の取得機能
- **概要**: NFCタグをスキャンしてトミカの情報を取得。
- **処理フロー**:
  1. ユーザーが「スキャン」ボタンを押下。
  2. NFCタグをスキャン。
  3. タグ内のデータを取得し、アプリ内で表示。
  4. Firebase Firestoreにスキャン日時を記録

### 3.2 トミカ情報の一覧表示機能
- **概要**: 所有しているトミカの情報を一覧表示。
- **処理フロー**:
  1. Firebase Firestoreからデータを取得。
  2. 一覧画面に表示。タブで切り替え可能。(タブは以下の3つ)
     1. 一覧表示内容:
        - トミカ名
        - スキャン日時
        - 登録日時
        - 更新日時
        - 持ち出し状況
     2. 行方不明トミカ一覧
        1. スキャン日時が1日以上前のトミカを表示。
     3. 持ち出し中トミカ一覧
        1. 持ち出し中のトミカを表示。
  3. ユーザーがトミカを選択して詳細画面に遷移。

### 3.3 新規登録機能
- **概要**: 新しいトミカをデータベースに登録し、NFCタグに情報を書き込む。
- **処理フロー**:
  1. ユーザーがトミカ情報を入力。
  2. NFCタグに情報を書き込む。
  3. 書き込み成功後、Firebase Firestoreにデータを保存。


### 3.4 トミカ情報の編集機能
- **概要**: 登録済みのトミカ情報を編集。
- **処理フロー**:
  1. 編集画面で情報を変更。
     1. 編集内容:
        - トミカ名
        - NFCタグID
        - 購入者名
        - 購入日付
        - メモ
  2. Firebase Firestoreに変更内容を保存。

### 3.5 トミカ情報の削除機能
- **概要**: 登録済みのトミカ情報を削除。
- **処理フロー**:
  1. 削除ボタンを押下。
  2. 確認ダイアログを表示
  3. Firebase Firestoreから該当データに削除日を入れて更新する。

### 3.6 トミカ情報の検索機能
- **概要**: トミカ情報を名前やIDで検索。
- **処理フロー**:
  1. 検索バーにキーワードを入力。
  2. Firebase Firestoreから該当データを取得し表示。

### 3.7 トミカ持ち出し機能
- **概要**: トミカの持ち出し状況を管理。
- **処理フロー**:
  1. 家を出る前に持ち出し登録を行う。
     - NFCタグをスキャンして持ち出しトミカを登録。
     - Firebase Firestoreに持ち出し登録日時を記録。
  2. 外出先からの帰宅時に持ち出しトミカがすべて揃っているか確認。
     - NFCタグをスキャンして持ち帰りトミカを登録。
     - 持ち出し登録されたトミカと持ち帰り登録されたトミカを比較。
     - 持ち出しトミカがすべて揃っている場合は「揃っている」と表示。
     - 不足しているトミカがある場合は、不足リストを表示。

---

## 4. データベース設計
### 4.1 コレクション: `Tomica`
| フィールド名       | 型          | 説明                     |
|--------------------|-------------|--------------------------|
| `id`               | String      | トミカの一意のID         |
| `name`             | String      | トミカの名前             |
| `nfcTagUID`        | String      | NFCタグのユニークID      |
| `scannedAt`        | Timestamp   | スキャン日時             |
| `isCheckedOut`     | Boolean     | 持ち出し中かどうか       |
| `checkedOutAt`     | Timestamp   | 持ち出し登録日時         |
| `checkedInAt`      | Timestamp   | 持ち帰り登録日時         |
| `purchaserName`    | String      | 購入者名                 |
| `purchaseDate`     | Timestamp   | 購入日付                 |
| `createdAt`        | Timestamp   | 登録日時                 |
| `updatedAt`        | Timestamp   | 更新日時                 |
| `deletedAt`        | Timestamp   | 削除日時                 |
| `memo`             | String      | メモ                     |

---

## 5. 画面設計
### 5.1 ホーム画面
- **概要**: トミカの一覧を表示。
- **要素**:
  - トミカ一覧
  - 検索バー
  - 新規登録ボタン

### 5.2 新規登録画面
- **概要**: 新しいトミカを登録。
- **要素**:
  - トミカ名入力フィールド
  - NFCタグ書き込みボタン
  - 保存ボタン

### 5.3 詳細画面
- **概要**: トミカの詳細情報を表示・編集。
- **要素**:
  - トミカ名
  - NFCタグID
  - 編集ボタン
  - 削除ボタン

---

## 6. メモ
- **NFCタグの読み取り・書き込み**:
  - `react-native-nfc-manager`を使用。
  - 書き込み時はNDEFフォーマットを使用。
- **音声フィードバック**:
  - NFCスキャン時に音声を再生（例: "ピッ"という音）。
- **ARマーカーの検討**:
  - NFCタグの代替案としてARマーカーを検討。
  - 同時に複数のトミカを認識する場合に有効。

---

## 7. 今後の課題
- トミカの金属素材によるNFCタグの読み取り精度の検証。
- 子どもが使いやすいUI/UXの設計。
- バーコードを使用した登録処理の実装検討。

---

# フェーズ設計

## フェーズ1: ユーザー情報なし
- 初期リリースでは、ユーザー情報を必要としないシンプルなトミカ管理機能を提供します。
- 主な機能:
  - トミカ情報の登録、編集、削除
  - NFCタグを使用したトミカ情報の取得
  - トミカ情報の一覧表示

## フェーズ2: ユーザー情報の追加
- Google Authenticationを使用してユーザー認証を導入します。
- ユーザーごとにトミカ情報を管理できるようにします。
- 家族設定機能を追加し、家族グループ内でトミカコレクションを共有可能にします。
- 主な機能:
  - ユーザー認証（Google Auth）
  - ユーザーごとのトミカ情報管理
  - 家族設定機能
  - 家族グループ内でのトミカ情報共有